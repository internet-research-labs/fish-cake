var svv=function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="assets/",i(i.s=1)}([function(e,t){e.exports=THREE},function(e,t,i){"use strict";i.r(t);var s=i(0);function n(e,t){var i=null;return function(){var s=this,n=arguments;clearTimeout(i),i=setTimeout(function(){t.apply(s,n)},e)}}function a(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}class h{constructor(e){this.id=e.id,this.el=document.getElementById(this.id),this.app={},this.width=this.el.offsetWidth,this.height=this.el.offsetHeight,this.state=e.state}setup(){this.app={view_angle:67,aspect:this.width/this.height,near:.01,far:200},this.needsUpdate=!1,this.scene=new s.Scene,this.renderer=new s.WebGLRenderer({antialias:!0,canvas:this.el}),this.renderer.setSize(this.width,this.height),this.renderer.setClearColor(16777215,1),this.renderer.setPixelRatio(1.5),document.body.appendChild(this.renderer.domElement);let e=new s.AmbientLight(7829367),t=(new s.DirectionalLight(13421772,.4),new s.PointLight(16711680,.5)),i=new s.PointLight(65535,.5);t.position.set(4.8,10,-.1),i.position.set(4,10,-0),this.scene.add(e),this.scene.add(t),this.scene.add(i),this.setupCamera();let[n,a,h]=[1,1.5,-1.5];this.resize(this.width,this.height),this.ships=new Map,this.targetShip=void 0}eventHandlers(){let e=this,t={x:0,y:0};return{keypress:t=>{switch(t.key){case" ":e.targetShip=e.targetShip?void 0:e.id}},keydown:{},resize:n(100,t=>{Math.min(window.innerWidth,window.innerHeight);this.width=window.innerWidth,this.height=window.innerHeight,e.resize(this.width,this.height)}),move:n(10,e=>{t.x=e.clientX,t.y=e.clientY;t.y,window.innerHeight,t.x,window.innerWidth})}}coord(e,t,i){let{radius:s,depth:n}=this.params;return[(s+(n+=i||0)*Math.cos(t))*Math.cos(e),n*Math.sin(t),(s+n*Math.cos(t))*Math.sin(e)]}updateWorld(e){this.params={radius:e.radius,depth:e.thickness};let t=new s.TorusGeometry(this.params.radius,this.params.depth,16,100),i=new s.MeshPhongMaterial({color:13421772,emissive:1118481,specular:4473924,shininess:90}),n=new s.Mesh(t,i);n.rotation.x=Math.PI/2,n.rotation.z=Math.PI/2,this.scene.add(n),e.buildings.forEach(e=>{let t=3*Math.random()+.1;t=3;let{theta:n,fi:h}=e,r=this.coord(n,h,1),o=this.coord(n,h,6),d=this.coord(n+.1,h,1),c=(a(o,r),a(d,r)),p=new s.Vector3(c[0],c[1],c[2]);p.normalize();let l=new s.Mesh(new s.BoxGeometry(.3,3,.3),i);l.position.set(r[0],r[1],r[2]),l.setRotationFromAxisAngle(p,h-Math.PI/2),this.scene.add(l)}),this.simulation=new s.Group,this.simulation.add(new s.LineSegments(new s.EdgesGeometry(new s.BoxGeometry(16,16,16)),new s.LineBasicMaterial({color:6710886}))),this.scene.add(this.simulation)}setupCamera(){this.camera=new s.PerspectiveCamera(this.app.view_angle,this.app.aspect,this.app.near,this.app.far),this.camera.position.set(0,30,0),this.camera.lookAt(0,0,0)}getShipObject(e){let t=this.scene.getObjectByName(e);if(null==t){t=new s.Mesh(new s.BoxGeometry(.5,.5,.5),new s.MeshBasicMaterial({color:0}));let e=2*Math.random()*Math.PI,i=2*Math.random()*Math.PI,n=2*Math.random()*Math.PI;t.rotation.set(e,i,n)}return t}updateShips(e){for(let t in e){let i=e[t],s=this.getShipObject("SHIP:"+t);this.ships.has(t)||(s.name="SHIP:"+t,this.scene.add(s));let[n,a,h]=this.coord(i.coord.theta,i.coord.fi,1);s.position.set(n,a,h),this.ships.set(t,i)}}updateSwifts(e){Object.keys(e).forEach(t=>{let i=e[t],n="SWIFT:"+t,{x:a,y:h,z:r}=i.pos,o=this.scene.getObjectByName(n);o||((o=new s.Mesh(new s.BoxGeometry(.1,.1,.1),new s.MeshBasicMaterial({color:255*Math.random()*16*16*16*16+255*Math.random()*16*16+255*Math.random()}))).name=n,this.scene.add(o)),o.position.set(a,h,r)})}update(e){if(this.needsUpdate&&(this.needsUpdate=!1),this.targetShip&&this.ships.has(this.targetShip)){let{coord:e}=this.ships.get(this.targetShip),{theta:t,fi:i}=e,[s,n,h]=this.coord(t,i),[r,o,d]=this.coord(t,i,40),[c,p,l]=a(this.coord(t,i+.01,40),this.coord(t,i-.01,40));this.camera.position.set(r,o,d),this.camera.up.set(c,p,l),this.camera.lookAt(s,n,h)}else{let e=new Date/5e4,t=20,i=t*Math.cos(e),s=t,n=t*Math.sin(e);this.camera.up.set(0,1,0),this.camera.position.set(i,s,n),this.camera.lookAt(0,0,0)}}resize(e,t){this.width=e,this.height=t,this.app.aspect=this.width/this.height,this.camera.aspect=this.app.aspect,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}draw(){this.renderer.render(this.scene,this.camera)}}class r{constructor(e){this.id=e.id,this.el=document.getElementById(this.id),this.app={},this.width=this.el.offsetWidth,this.height=this.el.offsetHeight,this.state=e.state}setup(){this.app={view_angle:67,aspect:this.width/this.height,near:.01,far:200},this.needsUpdate=!1,this.scene=new s.Scene,this.renderer=new s.WebGLRenderer({antialias:!0,canvas:this.el}),this.renderer.setSize(this.width,this.height),this.renderer.setClearColor(16777215,1),this.renderer.setPixelRatio(1.5),document.body.appendChild(this.renderer.domElement);let e=new s.AmbientLight(7829367),t=new s.DirectionalLight(13421772,.4),i=new s.PointLight(16711680,.5),n=new s.PointLight(65535,.5);i.position.set(4.8,10,-.1),n.position.set(4,10,-0),this.scene.add(e),this.scene.add(t),this.scene.add(i),this.scene.add(n),this.setupCamera(),this.resize(this.width,this.height)}eventHandlers(){let e=this,t={x:0,y:0};return{keypress:t=>{switch(t.key){case" ":e.targetShip=e.targetShip?void 0:e.id}},keydown:{},resize:n(100,t=>{Math.min(window.innerWidth,window.innerHeight);this.width=window.innerWidth,this.height=window.innerHeight,e.resize(this.width,this.height)}),move:n(10,e=>{t.x=e.clientX,t.y=e.clientY;t.y,window.innerHeight,t.x,window.innerWidth})}}coord(e,t,i){let{radius:s,depth:n}=this.params;return[(s+(n+=i||0)*Math.cos(t))*Math.cos(e),n*Math.sin(t),(s+n*Math.cos(t))*Math.sin(e)]}buildWorld(e){this.simulation=new s.Group,this.simulation.add(new s.LineSegments(new s.EdgesGeometry(new s.BoxGeometry(16,16,16)),new s.LineBasicMaterial({color:6710886}))),this.scene.add(this.simulation)}setupCamera(){this.camera=new s.PerspectiveCamera(this.app.view_angle,this.app.aspect,this.app.near,this.app.far),this.camera.position.set(0,30,0),this.camera.lookAt(0,0,0)}getShipObject(e){let t=this.scene.getObjectByName(e);if(null==t){t=new s.Mesh(new s.BoxGeometry(.5,.5,.5),new s.MeshBasicMaterial({color:0}));let e=2*Math.random()*Math.PI,i=2*Math.random()*Math.PI,n=2*Math.random()*Math.PI;t.rotation.set(e,i,n)}return t}updateShips(e){for(let t in e){let i=e[t],s=this.getShipObject("SHIP:"+t);this.ships.has(t)||(s.name="SHIP:"+t,this.scene.add(s));let[n,a,h]=this.coord(i.coord.theta,i.coord.fi,1);s.position.set(n,a,h),this.ships.set(t,i)}}updateSwifts(e){Object.keys(e).forEach(t=>{let i=e[t],n="SWIFT:"+t,{x:a,y:h,z:r}=i.pos,o=this.scene.getObjectByName(n);o||((o=new s.Mesh(new s.BoxGeometry(.1,.1,.1),new s.MeshBasicMaterial({color:255*Math.random()*16*16*16*16+255*Math.random()*16*16+255*Math.random()}))).name=n,this.scene.add(o)),o.position.set(a,h,r)})}update(e){this.needsUpdate=!1;let t=new Date/5e4;t=Math.PI/3;let i=20*Math.cos(t),s=20*Math.sin(t);this.camera.up.set(0,1,0),this.camera.position.set(i,7,s),this.camera.lookAt(0,0,0)}resize(e,t){this.width=e,this.height=t,this.app.aspect=this.width/this.height,this.camera.aspect=this.app.aspect,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}draw(){this.renderer.render(this.scene,this.camera)}}i.d(t,"lezgo",function(){return c}),i.d(t,"svvarm",function(){return d});let o={ships:[]};function d(e){let t=new r({id:e,state:o});t.setup(),t.buildWorld(),t.update(),t.draw();let i=new WebSocket("ws://"+location.host+"/swarm");i.addEventListener("open",function(e){console.log(e)}),i.addEventListener("message",function(e){let i=JSON.parse(e.data);i.ships;switch(i.type||i.Type){case"yupdate":t.updateSwifts(i.blob),t.update(),t.draw()}}),i.addEventListener("close",function(){console.log("CLOSED!")})}function c(e){let t=new h({id:e,state:o}),{keypress:i}=t.eventHandlers();return document.addEventListener("keypress",i),t.setup(),function(){let e=new WebSocket("ws://"+location.host+"/ws");e.addEventListener("open",function(e){console.log(e)}),e.addEventListener("message",function(e){let i=JSON.parse(e.data),s=i.ships,n=i.type||i.Type;switch(n){case"world":t.updateWorld(i.World);break;case"you-are":t.id=i.Id;break;case"bleep":t.updateSwifts(i.blob),t.needsUpdate=!0;break;default:t.updateShips(s),t.needsUpdate=!0}}),e.addEventListener("close",function(){console.log("CLOSED!")})}(),function e(){t.update(),t.draw(),requestAnimationFrame(e)}(),[t]}}]);